<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- Iron Elements -->
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<!-- Paper Elements -->
<link rel="import" href="../../bower_components/paper-styles/shadow.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<!-- App Elements -->
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">

<!-- Rhythm Elements -->
<link rel="import" href="rhythm-shelf-router.html">
<link rel="import" href="rhythm-shelf-data-store.html">
<link rel="import" href="rhythm-shelf-toolbar.html">
<link rel="import" href="../pages/home-page.html">
<link rel="import" href="../pages/text-input-page.html">
<link rel="import" href="../elements/rhythm-display.html">
<link rel="import" href="../elements/rhythm-text-input.html">
<link rel="import" href="../elements/login-check.html">


<dom-module id="rhythm-shelf-app">
  <template>
    <style>
      :host {
        display: block;
        --app-primary-color: var(--paper-blue-grey-500);
        --app-primary-light-color: var(--paper-blue-grey-300);
        --app-primary-dark-color: var(--paper-blue-grey-700);
        --app-secondary-color: var(--paper-teal-a100);

        --primary-color: var(--app-primary-color);
        --primary-text-color: black;


      }

      app-header {
        background-color: var(--app-primary-color);
      }

      app-header-layout {
        background: var(--app-primary-dark-color) ;
      }

      @media all and (min-width: 841px)  and (orientation: landscape) {
        div[main] {
          margin: 48px 20% 0;
        }
      }

    </style>

    <rhythm-shelf-data-store shelf="{{shelf}}"></rhythm-shelf-data-store>
    <rhythm-shelf-router route="{{route}}"></rhythm-shelf-router>
    <app-route
            route="{{route}}"
            pattern="/:page"
            data="{{routeData}}"
            tail="{{subroute}}">
    </app-route>

    <paper-toast id="toast"></paper-toast>

    <app-header-layout fullbleed has-scrolling-region>
        <app-header fixed shadow>
          <rhythm-shelf-toolbar selected="[[selected]]"></rhythm-shelf-toolbar>
        </app-header>

        <div main>
          <!--login-check user="{{user}}"-->

            <iron-pages selected="[[routeData.page]]" attr-for-selected="page" fallback-selection="view404">
              <div page="text-input">
                <rhythm-text-input></rhythm-text-input>
              </div>
              <div page="">
                <home-page id="homePage" shelf="[[shelf]]" selected="{{selected}}"></home-page>
              </div>
              <div page="view404">404</div>
            </iron-pages>

          <!--/login-check-->
        </div>
    </app-header-layout>
  </template>

  <script>
    Polymer({

      is: 'rhythm-shelf-app',
      listeners: {
        'add-rhythm': 'addRhythm',
        'show-notification': 'showNotification',
        'logout': 'logout',
         'create': 'create',
          'cancelSelect': 'cancelSelect',
          'remove': 'remove'
      },
      properties: {
        shelf: {
          type: Array,
          value: []
        },
        user: {
          type: Object,
          notify: true,
          value: null
        },
      },
        create: function() {
          this.navigate('text-input');
        },
        cancelSelect: function() {
          this.$.homePage.clearSelection();
        },
        remove: function(e) {
          this.cancelSelect();
          const outer = this;
          e.detail
            .sort(function(a, b){return b-a})
            .forEach(function(index) {
              outer.splice('shelf', index, 1);
          });
        },

      addRhythm: function(e) {
        this.push('shelf', e.detail);
          this.navigate('');
      },
      showNotification: function(e) {
        this.$.toast.show(e.detail);
      },
      logout: function() {
        this.set('user', null);
      },
        navigate: function(page) {
          this.set('routeData.page', page)
        }
    });
  </script>
</dom-module>
